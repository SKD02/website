<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–í–≠–î-–î–µ–∫–ª–∞—Ä–∞–Ω—Ç 2.0 ‚Äî –ú–∏–Ω–∏-–ø–æ–∏—Å–∫ –∫–æ–¥–∞ –¢–ù –í–≠–î</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg:#f8fafc; --card:#ffffff; --text:#0f172a; --muted:#64748b;
      --blue:#2563eb; --red:#dc2626; --border:#e2e8f0;
    }
    *{box-sizing:border-box}
    body{margin:0;color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial}

    /* ===== –§–æ–Ω: –∫–∞—Ä—Ç–∏–Ω–∫–∞ + –º—è–≥–∫–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç/—Ä–∞–∑–º—ã—Ç–∏–µ ===== */
    body::before{
      content:"";
      position:fixed; inset:0;
      /* üëá –∑–∞–º–µ–Ω–∏—Ç–µ URL –Ω–∞ –ª—é–±–æ–π —Å–≤–æ–π */
      background:url("https://transitllc.ru/storage/app/media/cache/fc/01/fc01df3e6d4d64cf1bbae6b2a97531e2.jpg") center/cover no-repeat fixed;
      z-index:-2;
    }
    body::after{
      content:"";
      position:fixed; inset:0;
      background:linear-gradient(180deg,rgba(255,255,255,.85),rgba(248,250,252,.9));
      backdrop-filter: blur(2px);
      z-index:-1;
    }

    .container{max-width:960px;margin:0 auto;padding:24px}
    .header{position:sticky;top:0;background:rgba(255,255,255,.75);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .h-wrap{display:flex;align-items:center;justify-content:space-between;padding:16px 24px}
    .logo{display:flex;align-items:center;gap:12px}
    .badge{width:36px;height:36px;border-radius:16px;background:var(--blue);box-shadow:0 1px 2px rgba(0,0,0,.08)}
    h1{font-size:18px;margin:0}.muted{color:var(--muted);font-size:12px;margin:0}
    .grid{display:grid;gap:24px} @media(min-width:960px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 1px 3px rgba(0,0,0,.06);padding:24px}
    .label{display:block;font-size:14px;font-weight:600;margin:0 0 6px}
    input,textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;outline:none}
    input:focus,textarea:focus{border-color:var(--blue);box-shadow:0 0 0 6px rgba(37,99,235,.08)}
    textarea{min-height:110px;resize:vertical}
    .row{display:flex;align-items:center;gap:12px}
    .btn{display:inline-flex;align-items:center;gap:10px;justify-content:center;padding:10px 16px;border:none;border-radius:12px;color:#fff;background:var(--blue);cursor:pointer;font-weight:600}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .link{font-size:14px;color:var(--muted);text-decoration:none}
    .err{color:var(--red);font-size:12px;margin-top:6px}
    .kv{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    dt{color:var(--muted);font-size:13px} dd{margin:0;font-weight:700}
    .code{background:#f1f5f9;border:1px solid var(--border);border-radius:12px;padding:14px;overflow:auto;font-family:ui-monospace,Consolas,Menlo,monospace;font-size:12px}
    .footer{margin-top:36px;text-align:center;color:var(--muted);font-size:12px}
    .copy{margin-left:auto;background:#0ea5e9}

    /* ===== –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ —Å–ø–∏–Ω–Ω–µ—Ä–æ–º ===== */
    .overlay{
      position:fixed; inset:0; display:none;
      align-items:center; justify-content:center;
      background:rgba(15,23,42,.25); backdrop-filter:blur(2px);
      z-index:99;
    }
    .spinner{
      width:56px; height:56px; border-radius:50%;
      border:5px solid rgba(255,255,255,.5);
      border-top-color:#2563eb;
      animation:spin 1s linear infinite;
      box-shadow:0 2px 10px rgba(0,0,0,.15);
    }
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <!-- –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <div id="loadingOverlay" class="overlay" aria-hidden="true">
    <div class="spinner" role="status" aria-label="–ó–∞–≥—Ä—É–∑–∫–∞"></div>
  </div>

  <header class="header">
    <div class="h-wrap container">
      <div class="logo">
        <div class="badge"></div>
        <div>
          <h1>–í–≠–î-–î–µ–∫–ª–∞—Ä–∞–Ω—Ç 2.0</h1>
          <p class="muted">–ú–∏–Ω–∏-–ø–æ–∏—Å–∫ –∫–æ–¥–∞ –¢–ù –í–≠–î</p>
        </div>
      </div>
      <a href="#" class="link" onclick="event.preventDefault();alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É. –î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–≤—ã—à–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å.');">–ü–æ–º–æ—â—å</a>
    </div>
  </header>

  <main class="container" style="padding-top:24px">
    <div class="grid">
      <!-- –§–æ—Ä–º–∞ -->
      <section class="card">
        <h2 style="margin:0 0 4px">–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–¥ –¢–ù –í–≠–î</h2>
        <p class="muted" style="margin:0 0 18px">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –Ω–∏–∂–µ. –î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–≤—ã—à–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å.</p>

        <div>
          <label class="label" for="manufacturer">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è</label>
          <input id="manufacturer" placeholder="–ù–∞–ø—Ä.: HANGZHOU WECOM TECHNOLOGY CO., LTD" />
          <div id="err_manufacturer" class="err" style="display:none">–£–∫–∞–∂–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è</div>
        </div>

        <div style="margin-top:14px">
          <label class="label" for="product">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
          <input id="product" placeholder="–ù–∞–ø—Ä.: PCBA 687264.601" />
          <div id="err_product" class="err" style="display:none">–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</div>
        </div>

        <div style="margin-top:14px">
          <label class="label" for="extra">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è <span class="muted">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label>
          <textarea id="extra" placeholder="–°–æ—Å—Ç–∞–≤, –º–∞—Ç–µ—Ä–∏–∞–ª, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ —Ç.–¥."></textarea>
        </div>

        <div class="row" style="margin-top:16px">
          <button id="submitBtn" class="btn">
            <span id="btnText">–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–¥ –¢–ù–í–≠–î</span>
          </button>
          <button id="resetBtn" class="link" style="border:none;background:none">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
      </section>

      <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
      <section class="card">
        <h3 style="margin:0 0 12px">–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>

        <div id="placeholder" class="muted" style="font-size:14px">
          –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∫–æ–¥ –¢–ù –í–≠–î –∏ —Å—Ç–∞–≤–∫–∏ –ø–æ—à–ª–∏–Ω—ã/–ù–î–° (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã).
        </div>

        <div id="resultCard" style="display:none">
          <div class="kv" style="background:#f8fafc;border:1px solid var(--border);border-radius:12px;padding:14px;margin:12px 0">
            <div><dt>–ö–æ–¥ –¢–ù –í–≠–î</dt><dd id="r_code">‚Äî</dd></div>
            <div><dt>–ü–æ—à–ª–∏–Ω–∞ (%)</dt><dd id="r_duty">‚Äî</dd></div>
            <div><dt>–ù–î–° (%)</dt><dd id="r_vat">‚Äî</dd></div>
            <div style="display:flex;align-items:center;gap:8px">
              <dt>–î–µ–π—Å—Ç–≤–∏—è</dt>
              <button id="copyBtn" class="btn copy">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
            </div>
          </div>
          <details>
            <summary class="label" style="font-weight:600;cursor:pointer">–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (payload)</summary>
            <pre id="r_payload" class="code">{}</pre>
          </details>
        </div>

        <div id="errorCard" class="err" style="display:none"></div>
      </section>
    </div>

    <div class="footer">¬© <span id="year"></span> –í–≠–î-–î–µ–∫–ª–∞—Ä–∞–Ω—Ç 2.0 ¬∑ –ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
  </main>

  <script>
    /* === –£–ö–ê–ñ–ò–¢–ï –°–í–û–ô API === */
    const API_BASE = "https://website-gfs1.onrender.com"; // Render FastAPI
    const $ = (id) => document.getElementById(id);
    const setText = (id, txt) => { $(id).textContent = txt; }
    const state = { loading:false, last:null };

    function setLoading(on){
      state.loading = on;
      $('submitBtn').disabled = on;
      $('loadingOverlay').style.display = on ? 'flex' : 'none';
      $('btnText').textContent = on ? '–û–ø—Ä–µ–¥–µ–ª—è–µ–º‚Ä¶' : '–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–¥ –¢–ù–í–≠–î';
    }

    function validate() {
      const m = $('manufacturer').value.trim();
      const p = $('product').value.trim();
      $('err_manufacturer').style.display = m ? 'none' : 'block';
      $('err_product').style.display = p ? 'none' : 'block';
      return m && p;
    }

    async function detect() {
      if (!validate() || state.loading) return;
      setLoading(true);
      $('errorCard').style.display = 'none';

      const payload = {
        manufacturer: $('manufacturer').value.trim(),
        product: $('product').value.trim(),
        extra: $('extra').value.trim() || null
      };

      try {
        const resp = await fetch(API_BASE.replace(/\/$/,'') + '/tnved/detect', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!resp.ok) throw new Error('–û—à–∏–±–∫–∞ API: ' + resp.status);
        const data = await resp.json();

        $('placeholder').style.display = 'none';
        $('resultCard').style.display = 'block';
        setText('r_code', data.code ?? '‚Äî');
        setText('r_duty', data.duty ?? '‚Äî');
        setText('r_vat',  data.vat  ?? '‚Äî');
        $('r_payload').textContent = JSON.stringify(payload, null, 2);
        state.last = data.code ?? '';
      } catch (e) {
        $('errorCard').style.display = 'block';
        $('errorCard').textContent = '–û—à–∏–±–∫–∞: ' + (e?.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
      } finally {
        setLoading(false);
      }
    }

    function resetForm() {
      $('manufacturer').value = ''; $('product').value = ''; $('extra').value = '';
      $('err_manufacturer').style.display = 'none'; $('err_product').style.display = 'none';
      $('resultCard').style.display = 'none'; $('errorCard').style.display = 'none';
      $('placeholder').style.display = 'block';
    }

    function copyCode() {
      const code = state.last || $('r_code').textContent.trim();
      if (!code || code === '‚Äî') { alert('–ö–æ–¥ –ø—É—Å—Ç. –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.'); return; }
      navigator.clipboard.writeText(code).then(() => {
        $('copyBtn').textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!'; setTimeout(()=> $('copyBtn').textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥', 1200);
      });
    }

    $('submitBtn').addEventListener('click', detect);
    $('resetBtn').addEventListener('click', (e)=>{ e.preventDefault(); resetForm(); });
    $('copyBtn').addEventListener('click', (e)=>{ e.preventDefault(); copyCode(); });
    $('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>

